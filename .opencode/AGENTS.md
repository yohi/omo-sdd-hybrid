# プロジェクトナレッジベース (.opencode)

## OVERVIEW
このディレクトリは OpenCode プラグインの **ソースコード本体 (src)** です。
仕様駆動開発 (SDD) を物理的に強制するための、ツール、プラグイン、共有ロジック、および実行状態（State）を含みます。

## STRUCTURE
- **lib/**: コアロジック。タスク解析、パス操作、状態管理ユーティリティ。
- **tools/**: `sdd_start_task` 等、OpenCode から呼び出される CLI コマンド。
- **plugins/**: `tool.execute.before` をフックし、検証を行う Gatekeeper ロジック。
- **state/**: 実行時のタスクコンテキストやロックファイルを保持。
- **skills/**: 各役割（Architect/Implementer）向けのプロンプト指示書。

## CONVENTIONS
- **lib ユーティリティの強制**: 状態更新やパス計算は、必ず `lib/` 内のユーティリティを使用すること。
- **ログプレフィックス**: Gatekeeper のログは `[SDD-GATEKEEPER]` を付与すること。
- **インポートの制限**: `.opencode` ディレクトリ外からのソースコードインポートは禁止。
- **モジュール完結**: 各ツールやプラグインは、独立性を保つこと。

## ANTI-PATTERNS
- **直接のファイル書き込み**: `fs.writeFileSync` を直接使わず、`lib/state-utils.ts` を経由する。
- **循環参照**: `tools` と `plugins` 間の循環依存を避ける（ロジックは `lib` に集約）。
- **ロジックの漏出**: ロジックファイルをルートディレクトリに配置しない。

---
**注意**: このディレクトリの変更はプラグイン全体の挙動に直結します。変更後は `__tests__/` での回帰テストが必須です。
