# プロジェクトナレッジベース (.opencode)

## OVERVIEW
このディレクトリは OpenCode プラグインの **ソースコード本体 (src)** です。
仕様駆動開発 (SDD) を物理的に強制するための、ツール、プラグイン、共有ロジック、および実行状態（State）を含みます。
通常のプロジェクトにおける `src/` に相当しますが、OpenCode の仕様に基づきこの場所に秘匿されています。

## STRUCTURE
- **lib/**: コアロジック。タスク解析、パス操作、状態管理ユーティリティを収容。
- **tools/**: `sdd_start_task` 等、OpenCode から呼び出される CLI コマンドの実装。
- **plugins/**: `edit`, `write` 等の操作をフックし、検証を行う Gatekeeper ロジック。
- **state/**: 実行時のタスクコンテキストやロックファイルを保持。
- **skills/**: 各役割（Architect/Implementer）向けのプロンプトと指示書。

## CONVENTIONS
- **lib ユーティリティの強制**: 状態更新やパス計算は、必ず `lib/` 内のユーティリティを使用すること。
- **インポートの制限**: `.opencode` ディレクトリ外からのソースコードインポートは禁止。
- **モジュール完結**: 各ツールやプラグインは、可能な限り独立して動作するよう設計すること。

## ANTI-PATTERNS
- **直接のファイル書き込み**: `fs.writeFileSync` 等を直接使わない。必ず `lib/state-utils.ts` を経由する。
- **循環参照**: `tools` と `plugins` 間の循環依存を避ける（ロジックは `lib` に集約する）。
- **ロジックの漏出**: ロジックファイルをルートディレクトリに配置しない。

---
**注意**: このディレクトリの変更はプラグイン全体の挙動に直結します。変更後は `__tests__/` での回帰テストが必須です。
